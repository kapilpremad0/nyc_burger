<div class="app-content content">
  <div class="content-overlay"></div>
  <div class="header-navbar-shadow"></div>
  <div class="content-wrapper container-xxl p-0">
    <div class="content-body">
      <div class="col-xl-12 col-lg-12">

        <!-- Back / Invoice Button -->
        <div class="mb-3 d-flex justify-content-between card">


          <div class="card-body">

            <script>
              document.addEventListener("DOMContentLoaded", () => {
                const params = new URLSearchParams(window.location.search);
                if (params.get('showQrCode') === 'true') {
                  const modalElement = document.getElementById('showQrCodeModal');
                  if (modalElement) {
                    const modal = new bootstrap.Modal(modalElement);
                    modal.show();
                  }
                }
              });
            </script>


            <!-- Update Status Form -->
            <form id="updateOrderForm" class="d-flex align-items-center" method="POST" action="/admin/orders/<%= order._id %>/update-status">
              <div class="me-2">
                <label for="paymentStatus" class="form-label mb-0"><strong>Payment Status:</strong></label>
                <select id="paymentStatus" name="paymentStatus" class="form-select">
                  <option value="pending" <%= order.paymentStatus === 'pending' ? 'selected' : '' %>>Pending</option>
                  <option value="completed" <%= order.paymentStatus === 'completed' ? 'selected' : '' %>>Completed</option>
                </select>
              </div>
              <div class="me-2">
                <label for="orderStatus" class="form-label mb-0"><strong>Order Status:</strong></label>
                <select id="orderStatus" name="status" class="form-select">
                  <option value="pending" <%= order.status === 'pending' ? 'selected' : '' %>>Pending</option>
                  <option value="baked" <%= order.status === 'baked' ? 'selected' : '' %>>Baked</option>
                  <option value="delivered" <%= order.status === 'delivered' ? 'selected' : '' %>>Delivered</option>
                </select>
              </div>
              <button type="submit" class="btn btn-primary mt-auto">Update</button>
              <span style="width: 10px;"></span><a href="#" class="btn btn-dark mt-auto me-2" data-bs-toggle="modal" data-bs-target="#showQrCodeModal">Show QR</a>
            </form>

          </div>
        </div>

        <div class="modal fade" id="showQrCodeModal" tabindex="-1" aria-labelledby="showQrCodeModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="showQrCodeModalLabel">QR Code</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
              </div>

              <div class="modal-body text-center">
                <!-- <p>Scan this QR code:</p> -->
                <img id="qrCodeImage" src="/qr_scan.jpeg" alt="QR Code" class="img-fluid" style="max-width: 250px;">
              </div>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header ">
            <h4 class="card-title mb-0">Order Details</h4>
            <a href="/invoice/<%= order.orderId %>" target="_blank" class="btn btn-success">
              <i class="fas fa-file-invoice"></i> View Invoice
            </a>
          </div>
          <div class="card-body">

            <!-- Order Info -->
            <!-- <h5 class="mb-3">Order Information</h5> -->
            <table class="table table-striped table-bordered mb-4">
              <tbody>
                <tr>
                  <th>Order ID</th>
                  <td><strong><%= order.orderId %></strong></td>
                </tr>
                <tr>
                  <th>Customer Name</th>
                  <td><strong><%= order.customerName || '-' %></strong></td>
                </tr>
                <tr>
                  <th>Mobile</th>
                  <td><strong><%= order.customerMobile || '-' %></strong></td>
                </tr>
                <tr>
                  <th>Branch</th>
                  <td><strong><%= order.branch ? order.branch.name : '-' %></strong></td>
                </tr>
                <tr>
                  <th>Order Type</th>
                  <td>
                    <% if(order.orderType === 'dinein') { %>
                    <span class="badge bg-primary">Dine-in</span>
                    <% } else if(order.orderType === 'takeaway') { %>
                    <span class="badge bg-warning">Takeaway</span>
                    <% } else { %>
                    <span class="badge bg-secondary">-</span>
                    <% } %>
                  </td>
                </tr>
                <tr>
                  <th>Payment Method</th>
                  <td>
                    <% if(order.paymentMethod === 'cash') { %>
                    <span class="badge bg-secondary">Cash</span>
                    <% } else if(order.paymentMethod === 'online') { %>
                    <span class="badge bg-success">Online</span>
                    <% } else { %>
                    <span class="badge bg-secondary">-</span>
                    <% } %>
                  </td>
                </tr>
                <tr>
                  <th>Coupon</th>
                  <td><%= order.coupon || '-' %></td>
                </tr>
                <tr>
                  <th>Amount</th>
                  <td>₹<%= order.amount.toFixed(2) %></td>
                </tr>
                <tr>
                  <th>Discount</th>
                  <td>₹<%= order.discount_amount.toFixed(2) %></td>
                </tr>
                <tr>
                  <th>Total Amount</th>
                  <td>₹<%= order.totalAmount.toFixed(2) %></td>
                </tr>
                <tr>
                  <th>Order From</th>
                  <td><%= order.order_from ? order.order_from.name : '-' %></td>
                </tr>
                <tr>
                  <th>Date</th>
                  <td><%= order.createdAt ? order.createdAt.toLocaleString() : '-' %></td>
                </tr>
              </tbody>
            </table>

            <!-- Cart Items -->
            <h5>Cart Items</h5>
            <% if(order.cart && order.cart.length > 0) { %>
            <table class="table table-bordered">
              <thead>
                <tr>
                  <th>#</th>
                  <th>Product Name</th>
                  <th>Price</th>
                  <th>Quantity</th>
                  <th>Total</th>
                </tr>
              </thead>
              <tbody>
                <% order.cart.forEach((item, i) => { %>
                <tr>
                  <td><%= i + 1 %></td>
                  <td><%= item.name %></td>
                  <td>₹<%= item.price.toFixed(2) %></td>
                  <td><%= item.qty %></td>
                  <td>₹<%= (item.price * item.qty).toFixed(2) %></td>
                </tr>
                <% }) %>
              </tbody>
            </table>
            <% } else { %>
            <p>No items in the cart.</p>
            <% } %>

          </div>
        </div>
      </div>
    </div>
  </div>
</div>